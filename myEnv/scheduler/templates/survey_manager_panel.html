{% extends 'base.html' %}

{% block title %}
{% if request.session.member_id %}
<h1>Zarządzanie i tworzenie ankiety</h1>
<p>
    {% if surveyExist %}
    Ankieta stworzona dnia
    <span class="glyphicon glyphicon-time"></span>
    {{ surveyCreationDate }}
    {% else %}
    Wypełnij poniższe pola aby stworzyć nową ankietę
    {% endif %}

</p>
{% else %}
<h1>Bład tworzenia ankiety </h1>
{% endif %}

{% endblock %}

{% block content %}
{% if request.session.member_id %}
<form action="{% url 'saveSurvey' %}" method="post" class="form-signin">
    {% csrf_token %}
    <p>
        <label>Tytuł:</label>
        <input name="title" type="text" id="inputEmail" class="form-control" placeholder="Nazwa wydarzenia" required
               autofocus>
        <label>Opis:</label>
        <textarea name="description" class="form-control" rows="5" id="comment"
                  placeholder="Szczegółowy opis wydarzenia" required></textarea>


        {% if dateTimes %}
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Od:</th>
            <th>Do:</th>
        </tr>
        </thead>
        <tbody>

        <!--
        Przykładowa konfiguracja
            id1 - seria liczb 0,2,4,6
            id2 - seria liczb 1,3,5,7
            fromDate - daty (może być None) dal serii id1
            toDate - daty (może być None) dla serii id2
        -->
        {% for id1,id2,fromDate,toDate in dateTimes %}

        <tr>
            <td>
                <div class='input-group date' name="dateTime{{ id1 }}" id='datetimepicker{{ id1 }}'>
                    <input type='text' class="form-control" value="{{ fromDate|date:'m/d/Y h:iA'  }}"/>
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                </div>
            </td>
            <td>
                <div class='input-group date' name="dateTime{{ id2 }}" id='datetimepicker{{ id2 }}'>
                    <input type='text' class="form-control" value="{{ toDate|date:'m/d/Y h:iA'  }}"/>
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
                </div>
            </td>
        </tr>

        {% endfor %}
        </tbody>
    </table>
        {% endif %}
    </p>

    <button class="btn btn-default navbar-bt" type="submit" style="width: 100%;">Zaloguj</button>
</form>

{% if dateTimes %}
<script type="text/javascript">

    $(function () {
        {% for id1,id2,fromDate,toDate in dateTimes %}

        $('#datetimepicker{{ id1 }}').datetimepicker();
        $('#datetimepicker{{ id2 }}').datetimepicker({
            useCurrent: false //Important! See issue #1075
        });
        $("#datetimepicker{{ id1 }}").on("dp.change", function (e) {
            $('#datetimepicker{{ id2 }}').data("DateTimePicker").minDate(e.date);
        });
        $("#datetimepicker{{ id2 }}").on("dp.change", function (e) {
            $('#datetimepicker{{ id1 }}').data("DateTimePicker").maxDate(e.date);
        });

        {% endfor %}
    });
{% endif %}

</script>
{% else %}
<p>
    Aby móc tworzyć ankiety musisz się zalogowac lub utworzyć bezpłatne konto.
</p>
{% endif %}
{% endblock %}