<div id="pageHeader">
    {% if request.session.member_id %}
    <h1>Zarządzanie kontem</h1>
    <p>
        <span class="glyphicon glyphicon-info-sign"></span>
        Tutaj możesz uzyskać dostęp do stworzonych przez Ciebie ankiet oraz zmieniać ustawienia swojego konta.
    </p>

    {% else %}
    <h1> Nie jesteś zalogowany </h1>
    {% endif %}
</div>

<div id="pageContent">
    <div class="col-sm-8">
        <div id="messageArea"></div>

        {% if request.session.member_id %}

        <div id="accountSumUp" class="partialView">
            <h1>Informacje o koncie:</h1>
            <table class="table-striped">
                <tr>
                    <td><strong>Imię:</strong></td>
                    <td>
                        {{ request.session.member_name }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <strong>
                            Nazwisko:
                        </strong>
                    </td>
                    <td>
                        {{ request.session.member_surname }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <strong>
                            Konto utworzone dnia:
                        </strong>
                    </td>

                    <td>
                        {{ signInDate }}
                    </td>
                </tr>
                <tr>
                    <td>
                        <strong>
                            Email:
                        </strong>
                    </td>
                    <td>
                        {{ email }}
                    </td>
                </tr>

            </table>
        </div>

        <div id="accountDataChange" class="partialView" style="display: none;">
            <h1>Zmiana danych osobowych</h1>
            <form action="{% url 'am_changeUserdata' %}" method="post">
                {% csrf_token %}
                <label>Imię :</label>
                <input name="member_name" type="text" id="member_name" class="form-control"
                       value={{ request.session.member_name }} required
                       autofocus>
                <label>Nazwisko :</label>
                <input name="member_surname" type="text" id="member_surname" class="form-control"
                       value={{ request.session.member_surname }} required
                       autofocus>

                <input type="submit" name="respond" value="Zmień" class="btn btn-default navbar-bt"/>
            </form>
        </div>

        <div id="accountChangePassword" class="partialView" style="display: none;">
            <h1>Zmiana hasła</h1>
            <form action="{% url 'am_changeUserpassword' %}" method="post">
                {% csrf_token %}

                <label>Stare Hasło:</label>
                <input type="password" name="oldpass" id="oldpass" class="form-control" placeholder="old password"
                       required>

                <label>Nowe Hasło:</label>
                <input type="password" name="pass" id="pass" class="form-control" placeholder="new password" required>


                <label>Powtórz nowe Hasło:</label>
                <input type="password" name="rpass" id="rpass" class="form-control" placeholder="repeat new password"
                       required>
                <input type="submit" name="respond" value="zmień" class="btn btn-default navbar-bt"
                       onClick="return validate()"/>
            </form>
        </div>

        <div id="accountSurveyList" class="partialView" style="display: none;">
            <h1>Lista ankiet:</h1>
            <table class="table-striped">
                <thead>
                <tr>
                    <th>
                        Tytuł
                    </th>
                    <th>
                        ID administratora
                    </th>
                    <th>
                        ID wypełniającego
                    </th>
                    <th>
                        Usuń
                    </th>
                </tr>
                </thead>

                {% for title,adminID,userID in listOfSurveys %}
                <tr>
                    <td>
                        {{ title }}
                    </td>
                    <td>
                        <a href="./surveyManager?adminID={{ adminID }}"><strong>{{ adminID }}</strong></a>
                    </td>
                    <td>
                        <a href="./surveyAnswer?userID={{ userID }}"><strong>{{ userID }}</strong></a>
                    </td>

                    <td>
                        <a href="./removeElement?adminID={{ adminID }}"><span
                                class="glyphicon glyphicon-remove-circle"></span></a>
                    </td>
                </tr>

                {% endfor %}
            </table>
        </div>


        <div id="accountStats" class="partialView" style="display: none;">
            <h1>Statystyki:</h1>

            <table class="table-striped">
                <tr>
                    <td><strong>Ilość dni od czasu rejestracji:</strong></td>
                    <td>
                        {{ daySinceRegister }}
                    </td>
                </tr>
                <tr>
                    <td><strong>Liczba utworzonych ankiet:</strong></td>
                    <td>
                        {{ numberOfSurveys }}
                    </td>
                </tr>
                <tr>
                    <td><strong>W tym utworzonych ostatnio:</strong></td>
                    <td>
                        {{ numberOfRecentS }}
                    </td>
                </tr>
                <tr>
                    <td><strong>Data utworzenia ostatniej ankiety:</strong></td>
                    <td>
                        {{ mostRecentSurvey }}
                    </td>
                </tr>
            </table>


            <div id="curve_chart" class="chartInPage" style="width: 100%"></div>

        </div>

    </div>

    <script src="/static/jq_accountManagement.js" type="text/javascript"></script>
    <script src="/static/jq_drawChart.js" type="text/javascript"></script>
    <script>

        function drawAll(){
                $(".chartInPage").height($("#pageContent").width()*3/6);
                drawLineChart('Ilosc wyslanych ankiet w ciągu ostatnich 10 dni',"",{{ plotData|safe }},curve_chart);
        }
        $(document).ready(
            function(){
                drawAll();
            }

        );

        $( window ).resize(
            function(){
                drawAll();
            }
        );

    </script>

    <div class="col-sm-4">
        <div class="list-group">
            <a href="accountSumUp" class="list-group-item insideNavLinkHide">Informacje o koncie</a>
            <a href="accountDataChange" class="list-group-item insideNavLinkShow">Zmiana danych osobowych</a>
            <a href="accountChangePassword" class="list-group-item insideNavLinkShow">Zmień hasło</a>
            <a href="accountSurveyList" class="list-group-item insideNavLinkShow">Lista ankiet</a>
            <a href="accountStats" id="statsLink" class="list-group-item insideNavLinkShow">Statystyki</a>
        </div>
    </div>

    {% else %}
    {% endif %}
</div>
